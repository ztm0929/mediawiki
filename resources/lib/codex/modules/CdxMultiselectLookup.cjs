"use strict";var k=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var w=(e,u)=>{var l={};for(var a in e)T.call(e,a)&&u.indexOf(a)<0&&(l[a]=e[a]);if(e!=null&&k)for(var a of k(e))u.indexOf(a)<0&&z.call(e,a)&&(l[a]=e[a]);return l};var M=(e,u,l)=>new Promise((a,d)=>{var s=n=>{try{r(l.next(n))}catch(i){d(i)}},m=n=>{try{r(l.throw(n))}catch(i){d(i)}},r=n=>n.done?a(n.value):Promise.resolve(n.value).then(s,m);r((l=l.apply(e,u)).next())});const t=require("vue"),E=require("./CdxChipInput.cjs"),H=require("./CdxMenu.cjs"),P=require("./useFieldData.cjs"),j=require("./useFloatingMenu.cjs"),x=require("./useGeneratedId.cjs"),W=require("./useModelWrapper.cjs"),G=require("./useOptionalModelWrapper.js"),J=require("./useSplitAttributes.cjs"),b=require("./constants.js"),Q=require("./_plugin-vue_export-helper.js"),X=b.makeStringTypeValidator(b.ValidationStatusTypes),Y=t.defineComponent({name:"CdxMultiselectLookup",components:{CdxChipInput:E,CdxMenu:H},props:{inputChips:{type:Array,required:!0},selected:{type:[Array],required:!0},menuItems:{type:Array,required:!0},inputValue:{type:[String,Number],default:null},separateInput:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},status:{type:String,default:"default",validator:X},menuConfig:{type:Object,default:()=>({})}},emits:["update:input-chips","update:selected","update:input-value","load-more","input","change","focus","blur"],setup:(e,{emit:u,attrs:l,slots:a})=>{const d=t.ref(),s=t.ref(),m=x("multiselect-lookup-menu"),r=t.computed(()=>{var o,p;return(p=(o=s.value)==null?void 0:o.getHighlightedMenuItem())==null?void 0:p.id}),n=t.ref(!1),i=t.ref(!1),h=t.ref(!1);t.provide(b.AllowArbitraryKey,t.ref(!1));const{computedDisabled:I,computedStatus:A}=P(t.toRef(e,"disabled"),t.toRef(e,"status")),R=t.computed(()=>({"cdx-multiselect-lookup--disabled":I.value,"cdx-multiselect-lookup--pending":n.value})),{rootClasses:B,rootStyle:U,otherAttrs:$}=J(l,R);j(d,s);const g=W(t.toRef(e,"selected"),u,"update:selected"),f=W(t.toRef(e,"inputChips"),u,"update:input-chips"),F=t.ref(""),y=G.useOptionalModelWrapper(F,t.toRef(e,"inputValue"),u,"update:input-value"),C=t.computed(()=>y.value.toString().length>0&&a["no-results"]);function K(o){return M(this,null,function*(){yield t.nextTick(),n.value=o!==null&&o!=="",u("input",o)})}function N(o){h.value=!0,(e.menuItems.length>0||C.value)&&(i.value=!0),u("focus",o)}function D(o){h.value=!1,i.value=!1,u("blur",o)}function L(o){!s.value||I.value||e.menuItems.length===0&&!C.value||o.key===" "||s.value.delegateKeyNavigation(o)}return t.watch(t.toRef(e,"selected"),o=>{const p=o.filter(v=>f.value.find(c=>v===c.value)===void 0);p.length>0&&(p.forEach(v=>{var q;const c=(q=s.value)==null?void 0:q.getComputedMenuItems().find(V=>V.value===v);if(c){const S=c,{id:V}=S,O=w(S,["id"]);f.value.push(O)}}),y.value="",u("input","")),f.value=f.value.filter(v=>o.find(c=>v.value===c)!==void 0)}),t.watch(t.toRef(e,"inputChips"),o=>{o.length<g.value.length&&(g.value=o.map(p=>p.value))}),t.watch(t.toRef(e,"menuItems"),o=>{o.length===0&&!C.value?i.value=!1:h.value&&n.value&&(i.value=!0),n.value=!1}),{chipInput:d,menu:s,menuId:m,highlightedId:r,expanded:i,computedDisabled:I,computedStatus:A,rootClasses:B,rootStyle:U,otherAttrs:$,selectedWrapper:g,inputChipsWrapper:f,computedInputValue:y,onUpdateInputValue:K,onInputBlur:D,onInputFocus:N,onKeydown:L}}});function Z(e,u,l,a,d,s){const m=t.resolveComponent("cdx-chip-input"),r=t.resolveComponent("cdx-menu");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["cdx-multiselect-lookup",e.rootClasses]),style:t.normalizeStyle(e.rootStyle)},[t.createVNode(m,t.mergeProps({ref:"chipInput","input-chips":e.inputChipsWrapper,"onUpdate:inputChips":u[0]||(u[0]=n=>e.inputChipsWrapper=n),"input-value":e.computedInputValue,"onUpdate:inputValue":u[1]||(u[1]=n=>e.computedInputValue=n)},e.otherAttrs,{class:"cdx-multiselect-lookup__chip-input",role:"combobox",autocomplete:"off","aria-autocomplete":"list","aria-controls":e.menuId,"aria-expanded":e.expanded,"aria-activedescendant":e.highlightedId,"separate-input":e.separateInput,disabled:e.computedDisabled,status:e.computedStatus,"disallow-arbitrary":!0,"onUpdate:inputValue":e.onUpdateInputValue,onFocus:e.onInputFocus,onBlur:e.onInputBlur,onKeydown:e.onKeydown}),null,16,["input-chips","input-value","aria-controls","aria-expanded","aria-activedescendant","separate-input","disabled","status","onUpdate:inputValue","onFocus","onBlur","onKeydown"]),t.createVNode(r,t.mergeProps({id:e.menuId,ref:"menu",selected:e.selectedWrapper,"onUpdate:selected":u[2]||(u[2]=n=>e.selectedWrapper=n),expanded:e.expanded,"onUpdate:expanded":u[3]||(u[3]=n=>e.expanded=n),"menu-items":e.menuItems},e.menuConfig,{onLoadMore:u[4]||(u[4]=n=>e.$emit("load-more"))}),{default:t.withCtx(({menuItem:n})=>[t.renderSlot(e.$slots,"menu-item",{menuItem:n})]),"no-results":t.withCtx(()=>[t.renderSlot(e.$slots,"no-results")]),_:3},16,["id","selected","expanded","menu-items"])],6)}const _=Q._export_sfc(Y,[["render",Z]]);module.exports=_;
